import { TimeSpanType } from '../types/TimeSpan.types';

/**
 * Checks if a date string is a valid ISO date.
 * @param date - date string to check
 * @returns boolean
 */
function isValidISODate(date: string) {
  return !isNaN(Date.parse(date));
}

/**
 * Formats a date string into a human-readable format.
 * @param date - date string to format
 * @param includeTime - whether to include the time in the formatted string
 * @returns string
 */
export function toHumanReadableDate(date: string, includeTime = false) {
  if (!isValidISODate(date)) {
    return date;
  }

  if (includeTime) {
    // return as YYYY-MM-DD HH:MM:SS
    return date.replace('T', ' ').split('.')[0];
  }

  return date.split('T')[0];
}

/**
 * Takes a TimeSpan and returns a Date object representing a start date.
 * Enum member allTime returns undefined.
 * @param timeSpan - time span to get start date for
 * @param now - current date
 * @returns Date
 * @throws Error
 */
export function getCveQueryPubStartDate(
  timeSpan: TimeSpanType,
  now: Date = new Date()
): Date | undefined {
  switch (timeSpan) {
    case 'All Time':
      return undefined;
    case 'Last 24 Hours':
      return new Date(now.getTime() - 24 * 60 * 60 * 1000);
    case 'Last 48 Hours':
      return new Date(now.getTime() - 48 * 60 * 60 * 1000);
    case 'Last 7 Days':
      return new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
    case 'Last 30 Days':
      return new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
    case 'Last 90 Days':
      return new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
    case 'Last 120 Days':
      return new Date(now.getTime() - 120 * 24 * 60 * 60 * 1000);
    default:
      throw new Error(`Invalid time span: ${timeSpan}`);
  }
}
