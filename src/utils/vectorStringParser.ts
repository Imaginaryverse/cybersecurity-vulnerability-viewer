import { VectorItem } from '../types/CVE.types';
import { VECTOR_VERSION_MAP } from './vectorMap';

export function parseVectorString(
  string: string,
  version: string
): VectorItem[] {
  const vectorMapByVersion =
    VECTOR_VERSION_MAP[version as keyof typeof VECTOR_VERSION_MAP];

  if (!vectorMapByVersion) {
    throw new Error(`Unknown vector version: ${version}`);
  }

  const vectorStrings = string.split('/');
  const vectors: VectorItem[] = [];

  for (const keyValuePair of vectorStrings) {
    const [name, value] = keyValuePair.split(':');

    if (!name || !value || name === 'CVSS' || !vectorMapByVersion[name]) {
      continue;
    }

    vectors.push({
      name: vectorMapByVersion[name]?.name ?? name,
      value: vectorMapByVersion[name]?.values[value] ?? value,
    });
  }

  return vectors;
}
