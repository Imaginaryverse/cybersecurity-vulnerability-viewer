import { FunctionComponent, useCallback } from 'react';
import { ParsedCve } from '../../../types/CVE.types';
import { useNavigate } from 'react-router-dom';
import { Button, Paper, Stack, Typography } from '@mui/material';
import { SeverityGauge } from '../SeverityGauge';
import { toHumanReadableDate } from '../../../utils/dateUtils';
import { ShowMoreText } from '../../molecules/ShowMoreText';
import {
  dateHeaderStyles,
  leftStackStyles,
  paperStyles,
  rightStackStyles,
} from './styles/ResultStackItem.styles';

type ResultStackItemProps = {
  cve: ParsedCve;
};

export const ResultStackItem: FunctionComponent<ResultStackItemProps> = ({
  cve,
}) => {
  const navigate = useNavigate();

  const handleCveClick = useCallback(
    () => navigate(`/vulnerability/${cve.id}`),
    [navigate, cve.id]
  );

  return (
    <Paper sx={paperStyles}>
      <Stack sx={leftStackStyles}>
        <Typography variant='body1'>
          <b>{cve.id}</b>
        </Typography>

        {cve.metrics?.baseScore ? (
          <SeverityGauge value={cve.metrics.baseScore} size={75} />
        ) : (
          <Typography variant='h6'>N/A</Typography>
        )}

        <Button onClick={handleCveClick} variant='contained' fullWidth>
          VIEW
        </Button>
      </Stack>

      <Stack sx={rightStackStyles}>
        <Stack sx={dateHeaderStyles}>
          <Typography variant='body2' width='50%' gutterBottom>
            <b>Published:</b> {toHumanReadableDate(cve.published, true)}
          </Typography>
          <Typography variant='body2' width='50%' gutterBottom>
            <b>Modified:</b> {toHumanReadableDate(cve.lastModified, true)}
          </Typography>
        </Stack>

        <ShowMoreText text={cve.description} limit={200} />

        <Typography variant='body2' sx={{ marginTop: 'auto' }}>
          <b>Source:</b> {cve.sourceIdentifier}
        </Typography>
      </Stack>
    </Paper>
  );
};
